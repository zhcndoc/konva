"use strict";(self.webpackChunkkonva_site_2=self.webpackChunkkonva_site_2||[]).push([[5639],{40863:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>g,default:()=>m,frontMatter:()=>l,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"docs/sandbox/Drop_DOM_Element","title":"\u5982\u4f55\u5c06 DOM \u56fe\u50cf\u62d6\u653e\u5230\u753b\u5e03\u4e2d","description":"\u5728\u8fd9\u4e2a\u6f14\u793a\u4e2d\uff0c\u6211\u4eec\u5c06\u5c55\u793a\u5982\u4f55\u5c06\u653e\u7f6e\u5728\u753b\u5e03\u5916\u90e8\u7684 DOM \u5143\u7d20\u62d6\u653e\u5230\u821e\u53f0\u4e2d\u3002","source":"@site/content/docs/sandbox/Drop_DOM_Element.mdx","sourceDirName":"docs/sandbox","slug":"/docs/sandbox/Drop_DOM_Element.html","permalink":"/docs/sandbox/Drop_DOM_Element.html","draft":false,"unlisted":false,"editUrl":"https://github.com/zhcndoc/konva/tree/main/content/docs/sandbox/Drop_DOM_Element.mdx","tags":[],"version":"current","frontMatter":{"title":"\u5982\u4f55\u5c06 DOM \u56fe\u50cf\u62d6\u653e\u5230\u753b\u5e03\u4e2d","sidebar_label":"\u653e\u7f6e DOM \u5143\u7d20","hide_table_of_contents":true,"slug":"Drop_DOM_Element.html"},"sidebar":"tutorialsSidebar","previous":{"title":"\u62d6\u653e\u538b\u529b\u6d4b\u8bd5","permalink":"/docs/sandbox/Drag_and_Drop_Stress_Test.html"},"next":{"title":"\u53ef\u7f16\u8f91\u6587\u672c","permalink":"/docs/sandbox/Editable_Text.html"}}');var r=t(74848),i=t(28453),s=t(11470),o=t(19365);const l={title:"\u5982\u4f55\u5c06 DOM \u56fe\u50cf\u62d6\u653e\u5230\u753b\u5e03\u4e2d",sidebar_label:"\u653e\u7f6e DOM \u5143\u7d20",hide_table_of_contents:!0,slug:"Drop_DOM_Element.html"},g=void 0,d={},c=[];function u(n){const e={a:"a",code:"code",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"\u5728\u8fd9\u4e2a\u6f14\u793a\u4e2d\uff0c\u6211\u4eec\u5c06\u5c55\u793a\u5982\u4f55\u5c06\u653e\u7f6e\u5728\u753b\u5e03\u5916\u90e8\u7684 DOM \u5143\u7d20\u62d6\u653e\u5230\u821e\u53f0\u4e2d\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["\u60a8\u770b\u5230\u7684\u7b2c\u4e00\u5f20\u56fe\u50cf\u662f\u4e00\u4e2a DOM \u56fe\u50cf\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(e.a,{href:"https://www.html5rocks.com/en/tutorials/dnd/basics/",children:"HTML5 \u62d6\u653e"})," \u6765\u542f\u7528\u5b83\u7684\u62d6\u52a8\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u9700\u8981\u5728\u89e6\u6478\u8bbe\u5907\u4e0a\u4e3a DOM \u5143\u7d20\u542f\u7528\u62d6\u653e\uff0c\u5219\u9700\u8981\u4e00\u4e9b\u989d\u5916\u7684\u6b65\u9aa4\u3002\u60a8\u53ef\u4ee5\u5728 ",(0,r.jsx)(e.a,{href:"https://mobiforge.com/design-development/touch-friendly-drag-and-drop",children:"\u8fd9\u91cc"})," \u9605\u8bfb\u66f4\u591a\u4fe1\u606f\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u8bf4\u660e\uff1a"})," \u5c06\u5c24\u8fbe\u62d6\u653e\u5230\u753b\u5e03\u4e2d\u3002"]}),"\n","\n",(0,r.jsxs)(s.A,{children:[(0,r.jsx)(o.A,{value:"Vanilla",default:!0,children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",metastring:"live vanilla",live:!0,children:"import Konva from 'konva';\n\nconst width = window.innerWidth;\nconst height = window.innerHeight;\n\n// \u6dfb\u52a0 DOM \u5143\u7d20\u4ee5\u5728\u5bb9\u5668\u5916\u90e8\u6e32\u67d3\ndocument.getElementById('container').insertAdjacentHTML(\n  'beforebegin',\n  `\n  <p>\u5c06\u5c24\u8fbe\u62d6\u653e\u5230\u7070\u8272\u533a\u57df\u3002</p>\n  <div id=\"drag-items\">\n    <img src=\"https://konvajs.org/assets/yoda.jpg\" draggable=\"true\" style=\"height: 100px; margin: 5px;\" />\n    <img src=\"https://konvajs.org/assets/darth-vader.jpg\" draggable=\"true\" style=\"height: 100px; margin: 5px;\" />\n  </div>\n`\n);\n\n// \u7528\u7070\u8272\u80cc\u666f\u6837\u5f0f\u5316\u5bb9\u5668\ndocument.getElementById('container').style.backgroundColor = 'rgba(0, 0, 0, 0.1)';\n\n// \u521b\u5efa\u821e\u53f0\u548c\u56fe\u5c42\nconst stage = new Konva.Stage({\n  container: 'container',\n  width: width,\n  height: height - 150, // \u7559\u51fa\u7a7a\u95f4\u7ed9 DOM \u5143\u7d20\n});\n\nconst layer = new Konva.Layer();\nstage.add(layer);\n\n// \u8ddf\u8e2a\u62d6\u52a8\u5143\u7d20\u7684 URL\nlet itemURL = '';\ndocument\n  .getElementById('drag-items')\n  .addEventListener('dragstart', function (e) {\n    itemURL = e.target.src;\n  });\n\n// \u5904\u7406\u5bb9\u5668\u4e0a\u7684 dragover\nconst container = stage.container();\ncontainer.addEventListener('dragover', function (e) {\n  e.preventDefault(); // \u91cd\u8981 - \u5fc5\u987b\u963b\u6b62\u9ed8\u8ba4\u884c\u4e3a\n});\n\n// \u5904\u7406\u5bb9\u5668\u4e0a\u7684 drop\ncontainer.addEventListener('drop', function (e) {\n  e.preventDefault();\n  \n  // \u624b\u52a8\u6ce8\u518c\u6307\u9488\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a DOM \u4e8b\u4ef6\n  stage.setPointersPositions(e);\n  \n  // \u52a0\u8f7d\u56fe\u50cf\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u56fe\u5c42\n  Konva.Image.fromURL(itemURL, function (image) {\n    // \u6839\u636e\u56fe\u50cf\u5c3a\u5bf8\u8ba1\u7b97\u5408\u9002\u7684\u5927\u5c0f\n    const img = image.image();\n    const maxDimension = 100;\n    let width = img.width;\n    let height = img.height;\n    \n    if (width > height) {\n      height = (height / width) * maxDimension;\n      width = maxDimension;\n    } else {\n      width = (width / height) * maxDimension;\n      height = maxDimension;\n    }\n    \n    image.size({\n      width: width,\n      height: height\n    });\n    \n    layer.add(image);\n    image.position(stage.getPointerPosition());\n    image.draggable(true);\n  });\n});\n"})})}),(0,r.jsx)(o.A,{value:"React",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",metastring:"live react",live:!0,children:"import { useState, useRef, useEffect } from 'react';\nimport { Stage, Layer, Image } from 'react-konva';\nimport { useImage } from 'react-konva-utils';\n\nconst DragItem = ({ src, onDragStart }) => {\n  return (\n    <img \n      src={src} \n      draggable={true}\n      style={{ height: '100px', margin: '5px' }}\n      onDragStart={() => onDragStart(src)} \n    />\n  );\n};\n\nconst App = () => {\n  const [images, setImages] = useState([]);\n  const [dragImageSrc, setDragImageSrc] = useState('');\n  const stageRef = useRef(null);\n  \n  const handleDragStart = (src) => {\n    setDragImageSrc(src);\n  };\n  \n  const handleDragOver = (e) => {\n    e.preventDefault(); // \u963b\u6b62\u9ed8\u8ba4\u884c\u4e3a\n  };\n  \n  const handleDrop = (e) => {\n    e.preventDefault();\n    \n    if (!dragImageSrc || !stageRef.current) return;\n    \n    // \u83b7\u53d6\u821e\u53f0\u548c\u6307\u9488\u4f4d\u7f6e\n    const stage = stageRef.current;\n    \n    // \u624b\u52a8\u6ce8\u518c\u6307\u9488\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a DOM \u4e8b\u4ef6\n    stage.setPointersPositions(e);\n    const position = stage.getPointerPosition();\n    \n    // \u5c06\u65b0\u56fe\u50cf\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\n    setImages([\n      ...images,\n      {\n        src: dragImageSrc,\n        x: position.x,\n        y: position.y,\n        id: Date.now().toString()\n      }\n    ]);\n  };\n  \n  return (\n    <div>\n      <p>\u5c06\u5c24\u8fbe\u62d6\u653e\u5230\u7070\u8272\u533a\u57df\u3002</p>\n      <div style={{ marginBottom: '10px' }}>\n        <DragItem \n          src=\"https://konvajs.org/assets/yoda.jpg\" \n          onDragStart={handleDragStart} \n        />\n        <DragItem \n          src=\"https://konvajs.org/assets/darth-vader.jpg\" \n          onDragStart={handleDragStart} \n        />\n      </div>\n      \n      <div \n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        style={{ backgroundColor: 'rgba(0, 0, 0, 0.1)' }}\n      >\n        <Stage\n          width={window.innerWidth}\n          height={window.innerHeight - 150}\n          ref={stageRef}\n        >\n          <Layer>\n            {images.map((img) => (\n              <KonvaImage\n                key={img.id}\n                src={img.src}\n                x={img.x}\n                y={img.y}\n                draggable\n              />\n            ))}\n          </Layer>\n        </Stage>\n      </div>\n    </div>\n  );\n};\n\n// \u5355\u72ec\u7684\u7ec4\u4ef6\uff0c\u7528\u4e8e Konva \u56fe\u50cf\u7684\u6b63\u786e\u52a0\u8f7d\nconst KonvaImage = ({ src, x, y, draggable }) => {\n  const [image] = useImage(src);\n  \n  if (!image) return null;\n  \n  // \u8ba1\u7b97\u5408\u9002\u7684\u5927\u5c0f\n  const maxDimension = 100;\n  let width = image.width;\n  let height = image.height;\n  \n  if (width > height) {\n    height = (height / width) * maxDimension;\n    width = maxDimension;\n  } else {\n    width = (width / height) * maxDimension;\n    height = maxDimension;\n  }\n  \n  return (\n    <Image\n      image={image}\n      x={x}\n      y={y}\n      width={width}\n      height={height}\n      draggable={draggable}\n    />\n  );\n};\n\nexport default App;\n"})})}),(0,r.jsx)(o.A,{value:"Vue",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",metastring:"live vue",live:!0,children:'<template>\n  <div>\n    <p>\u5c06\u5c24\u8fbe\u62d6\u653e\u5230\u7070\u8272\u533a\u57df\u3002</p>\n    <div style="margin-bottom: 10px;">\n      <img \n        src="https://konvajs.org/assets/yoda.jpg" \n        draggable="true" \n        style="height: 100px; margin: 5px;"\n        @dragstart="handleDragStart(\'https://konvajs.org/assets/yoda.jpg\')" \n      />\n      <img \n        src="https://konvajs.org/assets/darth-vader.jpg" \n        draggable="true" \n        style="height: 100px; margin: 5px;"\n        @dragstart="handleDragStart(\'https://konvajs.org/assets/darth-vader.jpg\')" \n      />\n    </div>\n    \n    <div \n      @dragover.prevent\n      @drop="handleDrop"\n      style="background-color: rgba(0, 0, 0, 0.1);"\n    >\n      <v-stage \n        ref="stageRef"\n        :config="stageConfig"\n      >\n        <v-layer>\n          <v-image\n            v-for="img in images"\n            :key="img.id"\n            :config="getImageConfig(img)"\n          />\n        </v-layer>\n      </v-stage>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from \'vue\';\n\nconst stageConfig = {\n  width: window.innerWidth,\n  height: window.innerHeight - 150\n};\n\nconst stageRef = ref(null);\nconst images = ref([]);\nconst dragImageSrc = ref(\'\');\nconst loadedImages = ref({});\n\n// \u5904\u7406\u62d6\u52a8\u5f00\u59cb\uff0c\u4ee5\u8ddf\u8e2a\u6b63\u5728\u62d6\u52a8\u7684\u56fe\u50cf\nconst handleDragStart = (src) => {\n  dragImageSrc.value = src;\n};\n\n// \u5904\u7406 drop \u4e8b\u4ef6\uff0c\u5c06\u56fe\u50cf\u6dfb\u52a0\u5230\u821e\u53f0\nconst handleDrop = (e) => {\n  e.preventDefault();\n  \n  if (!dragImageSrc.value || !stageRef.value) return;\n  \n  // \u83b7\u53d6\u821e\u53f0\u5f15\u7528\u5e76\u6ce8\u518c\u6307\u9488\u4f4d\u7f6e\n  const stage = stageRef.value.getNode();\n  stage.setPointersPositions(e);\n  const position = stage.getPointerPosition();\n  \n  // \u5982\u679c\u5c1a\u672a\u52a0\u8f7d\u56fe\u50cf\uff0c\u5219\u52a0\u8f7d\u56fe\u50cf\n  if (!loadedImages.value[dragImageSrc.value]) {\n    const img = new Image();\n    img.onload = () => {\n      loadedImages.value = {\n        ...loadedImages.value,\n        [dragImageSrc.value]: img\n      };\n      \n      // \u5c06\u56fe\u50cf\u6dfb\u52a0\u5230\u821e\u53f0\n      addImageToStage(dragImageSrc.value, position);\n    };\n    img.src = dragImageSrc.value;\n  } else {\n    // \u56fe\u50cf\u5df2\u52a0\u8f7d\uff0c\u6dfb\u52a0\u5230\u821e\u53f0\n    addImageToStage(dragImageSrc.value, position);\n  }\n};\n\n// \u8f85\u52a9\u51fd\u6570\u5c06\u56fe\u50cf\u6dfb\u52a0\u5230\u821e\u53f0\nconst addImageToStage = (src, position) => {\n  images.value.push({\n    src: src,\n    x: position.x,\n    y: position.y,\n    id: Date.now().toString()\n  });\n};\n\n// \u914d\u7f6e\u56fe\u50cf\u5c5e\u6027 \nconst getImageConfig = (img) => {\n  const image = loadedImages.value[img.src];\n  if (!image) return { x: img.x, y: img.y, draggable: true };\n  \n  // \u8ba1\u7b97\u5408\u9002\u7684\u5927\u5c0f\n  const maxDimension = 100;\n  let width = image.width;\n  let height = image.height;\n  \n  if (width > height) {\n    height = (height / width) * maxDimension;\n    width = maxDimension;\n  } else {\n    width = (width / height) * maxDimension;\n    height = maxDimension;\n  }\n  \n  return {\n    image: image,\n    x: img.x,\n    y: img.y,\n    width: width,\n    height: height,\n    draggable: true\n  };\n};\n<\/script>\n'})})})]})]})}function m(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(u,{...n})}):u(n)}},19365:(n,e,t)=>{t.d(e,{A:()=>s});t(96540);var a=t(34164);const r={tabItem:"tabItem_Ymn6"};var i=t(74848);function s({children:n,hidden:e,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,t),hidden:e,children:n})}},11470:(n,e,t)=>{t.d(e,{A:()=>I});var a=t(96540),r=t(34164),i=t(17559),s=t(23104),o=t(56347),l=t(205),g=t(57485),d=t(31682),c=t(70679);function u(n){return a.Children.toArray(n).filter((n=>"\n"!==n)).map((n=>{if(!n||(0,a.isValidElement)(n)&&function(n){const{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function m(n){const{values:e,children:t}=n;return(0,a.useMemo)((()=>{const n=e??function(n){return u(n).map((({props:{value:n,label:e,attributes:t,default:a}})=>({value:n,label:e,attributes:t,default:a})))}(t);return function(n){const e=(0,d.XI)(n,((n,e)=>n.value===e.value));if(e.length>0)throw new Error(`Docusaurus error: Duplicate values "${e.map((n=>n.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(n),n}),[e,t])}function h({value:n,tabValues:e}){return e.some((e=>e.value===n))}function p({queryString:n=!1,groupId:e}){const t=(0,o.W6)(),r=function({queryString:n=!1,groupId:e}){if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!e)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return e??null}({queryString:n,groupId:e});return[(0,g.aZ)(r),(0,a.useCallback)((n=>{if(!r)return;const e=new URLSearchParams(t.location.search);e.set(r,n),t.replace({...t.location,search:e.toString()})}),[r,t])]}function v(n){const{defaultValue:e,queryString:t=!1,groupId:r}=n,i=m(n),[s,o]=(0,a.useState)((()=>function({defaultValue:n,tabValues:e}){if(0===e.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:e}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${e.map((n=>n.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=e.find((n=>n.default))??e[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:e,tabValues:i}))),[g,d]=p({queryString:t,groupId:r}),[u,v]=function({groupId:n}){const e=function(n){return n?`docusaurus.tab.${n}`:null}(n),[t,r]=(0,c.Dv)(e);return[t,(0,a.useCallback)((n=>{e&&r.set(n)}),[e,r])]}({groupId:r}),f=(()=>{const n=g??u;return h({value:n,tabValues:i})?n:null})();(0,l.A)((()=>{f&&o(f)}),[f]);return{selectedValue:s,selectValue:(0,a.useCallback)((n=>{if(!h({value:n,tabValues:i}))throw new Error(`Can't select invalid tab value=${n}`);o(n),d(n),v(n)}),[d,v,i]),tabValues:i}}var f=t(92303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(74848);function D({className:n,block:e,selectedValue:t,selectValue:a,tabValues:i}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),g=n=>{const e=n.currentTarget,r=o.indexOf(e),s=i[r].value;s!==t&&(l(e),a(s))},d=n=>{let e=null;switch(n.key){case"Enter":g(n);break;case"ArrowRight":{const t=o.indexOf(n.currentTarget)+1;e=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(n.currentTarget)-1;e=o[t]??o[o.length-1];break}}e?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":e},n),children:i.map((({value:n,label:e,attributes:a})=>(0,x.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:n=>{o.push(n)},onKeyDown:d,onClick:g,...a,className:(0,r.A)("tabs__item",b.tabItem,a?.className,{"tabs__item--active":t===n}),children:e??n},n)))})}function w({lazy:n,children:e,selectedValue:t}){const i=(Array.isArray(e)?e:[e]).filter(Boolean);if(n){const n=i.find((n=>n.props.value===t));return n?(0,a.cloneElement)(n,{className:(0,r.A)("margin-top--md",n.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map(((n,e)=>(0,a.cloneElement)(n,{key:e,hidden:n.props.value!==t})))})}function y(n){const e=v(n);return(0,x.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",b.tabList),children:[(0,x.jsx)(D,{...e,...n}),(0,x.jsx)(w,{...e,...n})]})}function I(n){const e=(0,f.A)();return(0,x.jsx)(y,{...n,children:u(n.children)},String(e))}},28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>o});var a=t(96540);const r={},i=a.createContext(r);function s(n){const e=a.useContext(i);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),a.createElement(i.Provider,{value:e},n.children)}}}]);