"use strict";(self.webpackChunkkonva_site_2=self.webpackChunkkonva_site_2||[]).push([[5616],{33113:(a,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>e,toc:()=>d});const e=JSON.parse('{"id":"docs/sandbox/Image_Border","title":"\u56f4\u7ed5\u975e\u900f\u660e\u90e8\u5206\u7684\u56fe\u50cf\u8fb9\u6846","description":"\u5982\u4f55\u5728\u5177\u6709 alpha \u901a\u9053\u7684\u56fe\u50cf\u5468\u56f4\u7ed8\u5236\u8fb9\u6846\uff1f","source":"@site/content/docs/sandbox/Image_Border.mdx","sourceDirName":"docs/sandbox","slug":"/docs/sandbox/Image_Border.html","permalink":"/docs/sandbox/Image_Border.html","draft":false,"unlisted":false,"editUrl":"https://github.com/zhcndoc/konva/tree/main/content/docs/sandbox/Image_Border.mdx","tags":[],"version":"current","frontMatter":{"title":"\u56f4\u7ed5\u975e\u900f\u660e\u90e8\u5206\u7684\u56fe\u50cf\u8fb9\u6846","sidebar_label":"\u56fe\u50cf\u8fb9\u6846","hide_table_of_contents":true,"slug":"Image_Border.html"},"sidebar":"tutorialsSidebar","previous":{"title":"\u624b\u52bf\u4e8b\u4ef6","permalink":"/docs/sandbox/Gestures.html"},"next":{"title":"\u56fe\u7247\u8fb9\u6846\u9ad8\u4eae\u663e\u793a","permalink":"/docs/sandbox/Image_Border_Highlighting.html"}}');var s=t(74848),i=t(28453);const o={title:"\u56f4\u7ed5\u975e\u900f\u660e\u90e8\u5206\u7684\u56fe\u50cf\u8fb9\u6846",sidebar_label:"\u56fe\u50cf\u8fb9\u6846",hide_table_of_contents:!0,slug:"Image_Border.html"},r=void 0,c={},d=[{value:"\u5982\u4f55\u5728\u5177\u6709 alpha \u901a\u9053\u7684\u56fe\u50cf\u5468\u56f4\u7ed8\u5236\u8fb9\u6846\uff1f",id:"\u5982\u4f55\u5728\u5177\u6709-alpha-\u901a\u9053\u7684\u56fe\u50cf\u5468\u56f4\u7ed8\u5236\u8fb9\u6846",level:2}];function l(a){const n={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...a.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u5982\u4f55\u5728\u5177\u6709-alpha-\u901a\u9053\u7684\u56fe\u50cf\u5468\u56f4\u7ed8\u5236\u8fb9\u6846",children:"\u5982\u4f55\u5728\u5177\u6709 alpha \u901a\u9053\u7684\u56fe\u50cf\u5468\u56f4\u7ed8\u5236\u8fb9\u6846\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u6f14\u793a\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 Konva \u6846\u67b6\u7684\u81ea\u5b9a\u4e49\u6ee4\u955c\u521b\u5efa\u4e00\u4e2a\u8ddf\u968f\u5e26\u6709 alpha \u901a\u9053\u7684\u56fe\u50cf\u8f6e\u5ed3\u7684\u8fb9\u6846\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u7531\u4e8e\u51c6\u786e\u8ddf\u968f\u8f6e\u5ed3\u662f\u4e00\u9879\u590d\u6742\u7684\u4efb\u52a1\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\u6a21\u7cca\u9634\u5f71\u4f5c\u4e3a\u8fb9\u6846\u57fa\u7840\u7684\u6280\u672f\u3002\u8be5\u6ee4\u955c\u7528\u6211\u4eec\u5e0c\u671b\u7528\u4e8e\u8fb9\u6846\u7684\u5b9e\u5fc3\u989c\u8272\u66ff\u6362\u900f\u660e/\u6a21\u7cca\u7684\u50cf\u7d20\u3002"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u8bf4\u660e\uff1a"})," \u89c2\u5bdf\u5e26\u6709\u81ea\u5b9a\u4e49\u8fb9\u6846\u7684\u56fe\u50cf\uff0c\u8be5\u8fb9\u6846\u8ddf\u968f\u5176\u975e\u900f\u660e\u90e8\u5206\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:"live vanilla",live:!0,children:"import Konva from 'konva';\n\n// \u521b\u5efa\u821e\u53f0\nconst stage = new Konva.Stage({\n  container: 'container',\n  width: window.innerWidth,\n  height: window.innerHeight,\n});\n\nconst layer = new Konva.Layer();\nstage.add(layer);\n\n// \u5b9a\u4e49\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u6ee4\u955c\u7684\u53d8\u91cf\nlet canvas = document.createElement('canvas');\nlet tempCanvas = document.createElement('canvas');\n\n// \u4f7f\u6240\u6709\u50cf\u7d20\u53d8\u4e3a\u4e0d\u900f\u660e 100%\uff08\u9664\u4e86\u4e0d\u900f\u660e\u50cf\u7d20\uff09\nfunction removeTransparency(canvas) {\n  const ctx = canvas.getContext('2d');\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  const nPixels = imageData.data.length;\n  \n  for (let i = 3; i < nPixels; i += 4) {\n    if (imageData.data[i] > 0) {\n      imageData.data[i] = 255;\n    }\n  }\n  \n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.putImageData(imageData, 0, 0);\n  return canvas;\n}\n\n// \u5b9a\u4e49\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u8fb9\u6846\u6ee4\u955c\nfunction Border(imageData) {\n  const nPixels = imageData.data.length;\n  const size = this.getAttr('borderSize') || 0;\n\n  // \u8bbe\u7f6e\u753b\u5e03\u7684\u6b63\u786e\u5c3a\u5bf8\n  canvas.width = imageData.width;\n  canvas.height = imageData.height;\n\n  tempCanvas.width = imageData.width;\n  tempCanvas.height = imageData.height;\n\n  // \u5c06\u539f\u59cb\u5f62\u72b6\u7ed8\u5236\u5230\u4e34\u65f6\u753b\u5e03\u4e2d\n  tempCanvas.getContext('2d').putImageData(imageData, 0, 0);\n\n  // \u79fb\u9664 alpha \u901a\u9053\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5f71\u54cd\u9634\u5f71\uff08\u900f\u660e\u5f62\u72b6\u7684\u9634\u5f71\u8f83\u5c0f\uff09\n  removeTransparency(tempCanvas);\n\n  const ctx = canvas.getContext('2d');\n  const color = this.getAttr('borderColor') || 'black';\n\n  // \u4f7f\u7528\u9634\u5f71\u4f5c\u4e3a\u8fb9\u6846\n  ctx.save();\n  ctx.shadowColor = color;\n  ctx.shadowBlur = size;\n  ctx.drawImage(tempCanvas, 0, 0);\n  ctx.restore();\n\n  // \u83b7\u53d6 [\u539f\u59cb\u56fe\u50cf + \u9634\u5f71] \u7684\u56fe\u50cf\u6570\u636e\n  const tempImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n  const SMOOTH_MIN_THRESHOLD = 3;\n  const SMOOTH_MAX_THRESHOLD = 10;\n\n  let val, hasValue;\n  const offset = 3;\n\n  for (let i = 3; i < nPixels; i += 4) {\n    // \u8df3\u8fc7\u4e0d\u900f\u660e\u50cf\u7d20\n    if (imageData.data[i] === 255) {\n      continue;\n    }\n\n    val = tempImageData.data[i];\n    hasValue = val !== 0;\n    if (!hasValue) {\n      continue;\n    }\n    \n    if (val > SMOOTH_MAX_THRESHOLD) {\n      val = 255;\n    } else if (val < SMOOTH_MIN_THRESHOLD) {\n      val = 0;\n    } else {\n      val = ((val - SMOOTH_MIN_THRESHOLD) / (SMOOTH_MAX_THRESHOLD - SMOOTH_MIN_THRESHOLD)) * 255;\n    }\n    tempImageData.data[i] = val;\n  }\n\n  // \u5c06\u751f\u6210\u7684\u56fe\u50cf\uff08\u539f\u59cb + \u65e0\u4e0d\u900f\u660e\u5ea6\u9634\u5f71\uff09\u7ed8\u5236\u5230\u753b\u5e03\u4e0a\n  ctx.putImageData(tempImageData, 0, 0);\n\n  // \u7528\u989c\u8272\u586b\u5145\u6574\u5e45\u56fe\u50cf\uff08\u4e4b\u540e\u9634\u5f71\u7740\u8272\uff09\n  ctx.save();\n  ctx.globalCompositeOperation = 'source-in';\n  ctx.fillStyle = color;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  ctx.restore();\n\n  // \u5c06\u7740\u8272\u9634\u5f71\u590d\u5236\u5230\u539f\u59cb\u56fe\u50cf\u6570\u636e\u4e2d\n  const newImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n  const indexesToProcess = [];\n  for (let i = 3; i < nPixels; i += 4) {\n    const hasTransparentOnTop = imageData.data[i - imageData.width * 4 * offset] === 0;\n    const hasTransparentOnTopRight = imageData.data[i - (imageData.width * 4 + 4) * offset] === 0;\n    const hasTransparentOnTopLeft = imageData.data[i - (imageData.width * 4 - 4) * offset] === 0;\n    const hasTransparentOnRight = imageData.data[i + 4 * offset] === 0;\n    const hasTransparentOnLeft = imageData.data[i - 4 * offset] === 0;\n    const hasTransparentOnBottom = imageData.data[i + imageData.width * 4 * offset] === 0;\n    const hasTransparentOnBottomRight = imageData.data[i + (imageData.width * 4 + 4) * offset] === 0;\n    const hasTransparentOnBottomLeft = imageData.data[i + (imageData.width * 4 - 4) * offset] === 0;\n    \n    const hasTransparentAround =\n      hasTransparentOnTop ||\n      hasTransparentOnRight ||\n      hasTransparentOnLeft ||\n      hasTransparentOnBottom ||\n      hasTransparentOnTopRight ||\n      hasTransparentOnTopLeft ||\n      hasTransparentOnBottomRight ||\n      hasTransparentOnBottomLeft;\n\n    // \u8df3\u8fc7\u539f\u59cb\u56fe\u50cf\u4e2d\u7684\u50cf\u7d20\n    if (imageData.data[i] === 255 || (imageData.data[i] && !hasTransparentAround)) {\n      continue;\n    }\n    \n    if (!newImageData.data[i]) {\n      // \u8df3\u8fc7\u900f\u660e\u50cf\u7d20\n      continue;\n    }\n    \n    indexesToProcess.push(i);\n  }\n\n  for (let index = 0; index < indexesToProcess.length; index += 1) {\n    const i = indexesToProcess[index];\n    const alpha = imageData.data[i] / 255;\n\n    imageData.data[i] = newImageData.data[i];\n    imageData.data[i - 1] = newImageData.data[i - 1] * (1 - alpha) + imageData.data[i - 1] * alpha;\n    imageData.data[i - 2] = newImageData.data[i - 2] * (1 - alpha) + imageData.data[i - 2] * alpha;\n    imageData.data[i - 3] = newImageData.data[i - 3] * (1 - alpha) + imageData.data[i - 3] * alpha;\n  }\n}\n\n// \u52a0\u8f7d\u56fe\u50cf\u5e76\u5e94\u7528\u6ee4\u955c\nKonva.Image.fromURL('https://konvajs.org/assets/lion.png', function (image) {\n  layer.add(image);\n  image.setAttrs({\n    x: 80,\n    y: 30,\n    borderSize: 5,\n    borderColor: 'red',\n  });\n\n  image.filters([Border]);\n  image.cache();\n});\n"})})]})}function m(a={}){const{wrapper:n}={...(0,i.R)(),...a.components};return n?(0,s.jsx)(n,{...a,children:(0,s.jsx)(l,{...a})}):l(a)}},28453:(a,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var e=t(96540);const s={},i=e.createContext(s);function o(a){const n=e.useContext(i);return e.useMemo((function(){return"function"==typeof a?a(n):{...n,...a}}),[n,a])}function r(a){let n;return n=a.disableParentContext?"function"==typeof a.components?a.components(s):a.components||s:o(a.components),e.createElement(i.Provider,{value:n},a.children)}}}]);