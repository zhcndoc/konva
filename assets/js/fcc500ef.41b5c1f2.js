"use strict";(self.webpackChunkkonva_site_2=self.webpackChunkkonva_site_2||[]).push([[4039],{23714:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"docs/vue/Transformer","title":"\u5982\u4f55\u4f7f\u7528 Vue \u548c Konva \u8c03\u6574\u753b\u5e03\u5f62\u72b6\u7684\u5927\u5c0f\u548c\u65cb\u8f6c\uff1f","description":"\u76ee\u524d\uff0c\u6ca1\u6709\u7eaf\u58f0\u660e\u6027\u7684\u201cVue\u65b9\u5f0f\u201d\u4f7f\u7528 Transformer \u5de5\u5177\u3002","source":"@site/content/docs/vue/Transformer.mdx","sourceDirName":"docs/vue","slug":"/docs/vue/Transformer.html","permalink":"/docs/vue/Transformer.html","draft":false,"unlisted":false,"editUrl":"https://github.com/zhcndoc/konva/tree/main/content/docs/vue/Transformer.mdx","tags":[],"version":"current","frontMatter":{"title":"\u5982\u4f55\u4f7f\u7528 Vue \u548c Konva \u8c03\u6574\u753b\u5e03\u5f62\u72b6\u7684\u5927\u5c0f\u548c\u65cb\u8f6c\uff1f","sidebar_label":"Transformer","hide_table_of_contents":true,"slug":"Transformer.html"},"sidebar":"tutorialsSidebar","previous":{"title":"\u7b80\u5355\u52a8\u753b","permalink":"/docs/vue/Simple_Animations.html"},"next":{"title":"\u64a4\u9500/\u91cd\u505a","permalink":"/docs/vue/Undo-Redo.html"}}');var a=t(74848),o=t(28453);const s={title:"\u5982\u4f55\u4f7f\u7528 Vue \u548c Konva \u8c03\u6574\u753b\u5e03\u5f62\u72b6\u7684\u5927\u5c0f\u548c\u65cb\u8f6c\uff1f",sidebar_label:"Transformer",hide_table_of_contents:!0,slug:"Transformer.html"},c=void 0,l={},i=[];function d(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"\u76ee\u524d\uff0c\u6ca1\u6709\u7eaf\u58f0\u660e\u6027\u7684\u201cVue\u65b9\u5f0f\u201d\u4f7f\u7528 Transformer \u5de5\u5177\u3002\n\u4e0d\u8fc7\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8\u5c06\u5176\u9644\u52a0\u5230 Konva \u8282\u70b9\u6765\u6709\u6548\u4f7f\u7528\u5b83\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u8fd9\u4e2a\u60f3\u6cd5\u662f\u521b\u5efa\u4e00\u4e2a ",(0,a.jsx)(n.code,{children:"v-transformer"})," \u7ec4\u4ef6\uff0c\u5e76\u5728\u9009\u4e2d\u65f6\u624b\u52a8\u5c06\u5176\u9644\u52a0\u5230\u6240\u9700\u7684\u8282\u70b9\u4e0a\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u8bf4\u660e\uff1a\u70b9\u51fb\u5f62\u72b6\u4ee5\u9009\u62e9\u5b83\u3002\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u53d8\u6362\u624b\u67c4\u8c03\u6574\u5176\u5927\u5c0f\u548c\u65cb\u8f6c\u3002\u5f62\u72b6\u5c06\u5728\u53d8\u6362\u540e\u6539\u53d8\u989c\u8272\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:"live vue",live:!0,children:"<template>\n  <v-stage\n    ref=\"stage\"\n    :config=\"stageSize\"\n    @mousedown=\"handleStageMouseDown\"\n    @touchstart=\"handleStageMouseDown\"\n  >\n    <v-layer ref=\"layer\">\n      <v-rect\n        v-for=\"item in rectangles\"\n        :key=\"item.id\"\n        :config=\"item\"\n        @transformend=\"handleTransformEnd\"\n      />\n      <v-transformer ref=\"transformer\" />\n    </v-layer>\n  </v-stage>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport Konva from 'konva';\n\nconst stageSize = {\n  width: window.innerWidth,\n  height: window.innerHeight\n};\n\nconst rectangles = ref([\n  {\n    rotation: 0,\n    x: 10,\n    y: 10,\n    width: 100,\n    height: 100,\n    scaleX: 1,\n    scaleY: 1,\n    fill: 'red',\n    name: 'rect1',\n    draggable: true\n  },\n  {\n    rotation: 0,\n    x: 150,\n    y: 150,\n    width: 100,\n    height: 100,\n    scaleX: 1,\n    scaleY: 1,\n    fill: 'green',\n    name: 'rect2',\n    draggable: true\n  }\n]);\n\nconst selectedShapeName = ref('');\nconst transformer = ref(null);\n\nconst handleTransformEnd = (e) => {\n  // \u5728\u6211\u4eec\u7684\u72b6\u6001\u4e2d\u627e\u5230\u5143\u7d20\n  const rect = rectangles.value.find(\n    (r) => r.name === selectedShapeName.value\n  );\n  if (!rect) return;\n\n  // \u7528\u65b0\u5c5e\u6027\u66f4\u65b0\u72b6\u6001\n  rect.x = e.target.x();\n  rect.y = e.target.y();\n  rect.rotation = e.target.rotation();\n  rect.scaleX = e.target.scaleX();\n  rect.scaleY = e.target.scaleY();\n\n  // \u968f\u673a\u6539\u53d8\u586b\u5145\u989c\u8272\n  rect.fill = Konva.Util.getRandomColor();\n};\n\nconst updateTransformer = () => {\n  const transformerNode = transformer.value.getNode();\n  const stage = transformerNode.getStage();\n  const selected = selectedShapeName.value;\n\n  const selectedNode = stage.findOne('.' + selected);\n  // \u5982\u679c\u9009\u62e9\u7684\u8282\u70b9\u5df2\u7ecf\u9644\u52a0\uff0c\u5219\u4ec0\u4e48\u4e5f\u4e0d\u505a\n  if (selectedNode === transformerNode.node()) {\n    return;\n  }\n\n  if (selectedNode) {\n    // \u9644\u52a0\u5230\u9009\u4e2d\u7684\u8282\u70b9\n    transformerNode.nodes([selectedNode]);\n  } else {\n    // \u79fb\u9664\u53d8\u6362\u5668\n    transformerNode.nodes([]);\n  }\n};\n\nconst handleStageMouseDown = (e) => {\n  // \u70b9\u51fb\u821e\u53f0 - \u6e05\u9664\u9009\u62e9\n  if (e.target === e.target.getStage()) {\n    selectedShapeName.value = '';\n    updateTransformer();\n    return;\n  }\n\n  // \u70b9\u51fb\u53d8\u6362\u5668 - \u4e0d\u505a\u4efb\u4f55\u4e8b\n  const clickedOnTransformer =\n    e.target.getParent().className === 'Transformer';\n  if (clickedOnTransformer) {\n    return;\n  }\n\n  // \u6839\u636e\u540d\u5b57\u627e\u5230\u88ab\u70b9\u51fb\u7684\u77e9\u5f62\n  const name = e.target.name();\n  const rect = rectangles.value.find((r) => r.name === name);\n  if (rect) {\n    selectedShapeName.value = name;\n  } else {\n    selectedShapeName.value = '';\n  }\n  updateTransformer();\n};\n<\/script>\n"})})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var r=t(96540);const a={},o=r.createContext(a);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);